<template>
  <header :class="[{ 'Header--bg': isScrolled }, 'Header']">
    <router-link :to="homeRoute">
      <!-- <div class="Header__logo">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 111 30"
          focusable="true"
        >
          <g id="netflix-logo">
            <path
              d="M105.062 14.28L111 30c-1.75-.25-3.499-.563-5.28-.845l-3.345-8.686-3.437 7.969c-1.687-.282-3.344-.376-5.031-.595l6.031-13.75L94.468 0h5.063l3.062 7.874L105.875 0h5.124l-5.937 14.28zM90.47 0h-4.594v27.25c1.5.094 3.062.156 4.594.343V0zm-8.563 26.937c-4.187-.281-8.375-.53-12.656-.625V0h4.687v21.875c2.688.062 5.375.28 7.969.405v4.657zM64.25 10.657v4.687h-6.406V26H53.22V0h13.125v4.687h-8.5v5.97h6.406zm-18.906-5.97V26.25c-1.563 0-3.156 0-4.688.062V4.687h-4.844V0h14.406v4.687h-4.874zM30.75 15.593c-2.062 0-4.5 0-6.25.095v6.968c2.75-.188 5.5-.406 8.281-.5v4.5l-12.968 1.032V0H32.78v4.687H24.5V11c1.813 0 4.594-.094 6.25-.094v4.688zM4.78 12.968v16.375C3.094 29.531 1.593 29.75 0 30V0h4.469l6.093 17.032V0h4.688v28.062c-1.656.282-3.344.376-5.125.625L4.78 12.968z"
            ></path>
          </g>
        </svg>
      </div> -->
      <div class="logo-holder logo-4">
        <a href="">
          <h3>Viuviu</h3>
          <p>.com</p>
        </a>
      </div>
    </router-link>

    <nav :class="[{ 'Header__nav--opened': isMenuOpened }, 'Header__nav']">
      <ul class="Header__nav-list">
        <li
          class="Header__nav-item"
          v-for="(navItem, index) in navList"
          :key="index"
        >
          <router-link
            v-if="!navItem.nav"
            class="Header__nav-link"
            :to="navItem.link"
          >
            {{ navItem.title }}
          </router-link>
          <div v-else class="Header__nav-link">
            {{ navItem.title }}
            <div class="dropdown">
              <div
                class="dropdown__list"
                v-for="(dropdownItem, index) in navItem.nav"
                :key="index"
              >
                <router-link
                  class="dropdown__btn"
                  :to="`${navItem.link}/${dropdownItem.id}`"
                >
                  {{ dropdownItem.name }}
                </router-link>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </nav>

    <div class="flex justify-end">
      <font-awesome-icon
        :icon="['fas', 'search']"
        class="Header__search-icon"
      />
      <!-- <input
          name="search"
          type="text"
          placeholder="Titles, characters, geners"
          v-model="search"
          class="Header__search-input"
        /> -->
    </div>

    <div class="Header__actions">
      <ProfileDropdown />
      <button
        :class="[{ 'hamburger--active': isMenuOpened }, 'hamburger', 'button']"
        v-on:click="toggleSidebar"
      >
        <span />
        <span />
        <span />
      </button>
    </div>
  </header>
</template>

<script>
import ProfileDropdown from "../ProfileDropdown/ProfileDropdown.vue";
import debounce from "@/helpers/debounce";
import { routes } from "@/helpers/constants";
import { useI18n } from "vue-i18n";
export default {
  name: "AuthorizedHeader",
  data() {
    return {
      search: "",
      isScrolled: false,
      isMenuOpened: false,
      homeRoute: routes.home,
      navList: [
        {
          title: useI18n({ useScope: "global" }).t("navigation.home"),
          link: routes.home,
        },
        {
          title: useI18n({ useScope: "global" }).t("navigation.genres"),
          link: routes.tvShows,
          nav: [],
        },
        {
          title: useI18n({ useScope: "global" }).t("navigation.top"),
          link: routes.movies,
        },
        {
          title: useI18n({ useScope: "global" }).t("navigation.author"),
          link: routes.popular,
        },
      ],
    };
  },
  computed: {
    path() {
      return this.$route.path;
    },
    // genres() {
    //   return this.$store?.getters?.genres;
    // },
  },
  components: {
    ProfileDropdown,
  },
  watch: {
    path() {
      this.isMenuOpened = false;
    },
    genres(value) {
      if (value !== null && value !== undefined) {
        this.navList = this.navList.map((item) => {
          if (item.title === "TV Shows") return { ...item, nav: value.tv };
          if (item.title === "Movies") return { ...item, nav: value.movies };
          return item;
        });
      }
    },
    search: debounce(function (value) {
      this.$router.push(`${routes.search}/${value}`);
    }, 600),
  },
  methods: {
    handleScroll() {
      const currentScrollPosition =
        window.pageYOffset || document.documentElement.scrollTop;
      if (currentScrollPosition > 30) return (this.isScrolled = true);
      else return (this.isScrolled = false);
    },
    toggleSidebar() {
      this.isMenuOpened = !this.isMenuOpened;
      if (this.isMenuOpened)
        document.documentElement.classList.add("no-scroll");
      else document.documentElement.classList.remove("no-scroll");
    },
  },
  created() {
    window.addEventListener("scroll", this.handleScroll);
  },
  // mounted() {
  //   if (this.$route.params.search) {
  //     this.search = this.$route.params.search;
  //   }
  //   // return this.$store.dispatch(actions.setGenres);
  // },
  unmounted() {
    window.removeEventListener("scroll", this.handleScroll);
  },
};
</script>

<style lang="scss">
@import "./Header.scss";
.logo-4 p {
  font-size: 8px;
  margin-left: 50px;
  color: #e4e4e4;
  font-weight: 400;
  text-transform: capitalize;
  font-style: italic;
  font-family: "Mansalva", cursive;
}
.logo-4 h3 {
  color: #ea1700;
  font-weight: 800;
  font-size: 24px;
  line-height: 0.65;
  font-family: "Lobster", cursive;
}
</style>
